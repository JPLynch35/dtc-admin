<%# Nav %>

<nav class="navbar is-white">
  <%= image_tag "DressTheChild.png", class: "dtc-logo" %>
  <div class="navbar-end">
    <div class="navbar-item">
      <%= link_to "Sign Out", destroy_user_session_path, method: :delete, class: "button is-outlined is-danger", id: "sign-out-btn" %>
      <br>
      <%= link_to "Change Password", edit_user_registration_path, class: "button is-outlined is-dark" %> 
    </div>
  </div>
</nav>

<div class="tabs is-boxed tabs-background is-fullwidth">
  <ul>
    <li class="is-active">
      <a>
        <span class="icon is-small"><i class="fas fa-hand-holding-usd" aria-hidden="true"></i></span>
        <span>Donations</span>
      </a>
    </li>
    <li>
      <a>
        <span class="icon is-small"><i class="fas fa-users" aria-hidden="true"></i></span>
        <span>Contacts</span>
      </a>
    </li>
    <li>
      <a>
        <span class="icon is-small"><i class="fas fa-user-edit" aria-hidden="true"></i></span>
        <span>Users</span>
      </a>
    </li>
  </ul>
</div>

<div class="container" id="main">

<div class="circles">
    <div class="metric-square">
      Total Donors
      <div class="donors-circle"><%= @presenter.retrieve_total_donors %></div>
    </div>
    <div class="metric-square">
      Stripe
      <div class="stripe-circle"><%= number_to_currency(@presenter.retrieve_stripe_subtotal, unit: '$', precision: 0) %></div>
    </div>
    <div class="metric-square">
      Total Raised
      <div class="donations-circle"><%= number_to_currency(@presenter.retrieve_all_total, unit: '$', precision: 0) %></div>
    </div>
    <div class="metric-square">
      Checks
      <div class="checks-circle"><%= number_to_currency(@presenter.retrieve_check_subtotal, unit: '$', precision: 0) %></div>
    </div>
    <div class="metric-square">
      Kids Sponsored
      <div class="kids-circle"><%= @presenter.calculate_kids_sponsored %></div>
    </div>
  </div>

  <div class="container" id="filter-form">
    <%= form_for '', :method => :get do |f| %>
      <%= f.date_field :start_date, class: 'input is-primary', placeholder: "date", id: "start" %>
      <%= f.date_field :end_date, class: 'input is-primary', placeholder: "date", id: "end" %>
      <%= f.submit 'Filter Donations', class: "button is-inverted is-outlined is-link", id: "filter-btn"%>
    <% end %>
  </div>

  <div class="container" id="donations-table">
    <table class="table is-narrow is-hoverable is-fullwidth">
      <thead>
        <tr>
          <th>Name</th>
          <th>City</th>
          <th>State</th>
          <th>Email</th>
          <th>Amount</th>
          <th>Date</th>
          <th>Type</th>
        </tr>
      </thead>
      <tbody>
        <% @presenter.retrieve_all_donations.each do |donation| %>
          <tr>
            <td class="name"><%= donation.name %></td>
            <td class="city"><%= donation.city %></td>
            <td class="state"><%= donation.state %></td>
            <td class="email"><%= donation.email %></td>
            <td class="amount"><%= number_to_currency(donation.amount.to_i / 100.00, unit: '$') %></td>
            <td class="date"><%= donation.date %></td>
            <% if donation.donation_type == "Check" %>
              <td width=9%><%= donation.donation_type %> <%= link_to donation_path(donation), method: :delete, data: { confirm: 'Are you sure you want to delete this donation?' } do %><i class="far fa-trash-alt"></i><% end %></td>
            <% else %>
              <td class="type"><%= donation.donation_type %></td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="container" id="donate-form">
    <p>Fill out the form to add a new check or cash donation.</p>
    <%= form_for @presenter.create_new_donation do |f| %>
      <%= f.text_field :name, class: 'input is-primary', placeholder: "name", id:"name" %>
      <%= f.text_field :city, class: 'input is-primary', placeholder: "city", id:"city" %>
      <%= f.text_field :state, class: 'input is-primary', placeholder: "state", id:"state" %>
      <%= f.text_field :email, class: 'input is-primary', placeholder: "email", id:"email" %>
      <%= f.number_field :amount, class: 'input is-primary', placeholder: "amount", id:"amount" %>
      <%= f.date_field :date, class: 'input is-primary', placeholder: "date", id:"date" %>
      <%= f.hidden_field :donation_type, value: 'Check' %>
      <%= f.hidden_field :stripe_id, value: '' %>
      <%= f.submit "Add Donation", class: "button is-inverted is-outlined is-link" %>
    <% end %>
  </div>
</div>